# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения  

Приложение основано на паттерне проектирования MVP (Model-View-Presenter).  
В рамках этой архитектуры:  
* Модель (Model) отвечает за работу с данными (получение, преобразование, хранение).  
* Представление (View) отвечает за отображение данных на экране.  
* Презентер (Presenter) взаимодействует с моделью и представлением, реализует логику приложения и обновляет интерфейс на основе данных  

### Классы с группировкой по слоям.  
1. **Слой модели:**  

1.1. BasketModel  
Поля:  

* basket: BasketItemUI[] - локальное состояние корзины, массив товаров.  

* total: string - общая стоимость корзины в форматированной строке "1000 синапсов".  

* apiClient: ApiClient - объект для взаимодействия с API.  

* formatter: Formatter - объект для форматирования данных.  

Методы:  

* getBasket(): BasketItemUI[] - возвращает текущее состояние корзины.  
_Задача: управление локальным состоянием корзины._  

* addItemToBasket(productId: string): Promise<void> - добавляет товар в корзину и синхронизирует это с сервером.  
_Задача: обновить состояние корзины на клиенте и отправить запрос на сервер._  

* removeItemFromBasket(productId: string): Promise<void> - удаляет товар из корзины и синхронизирует это с сервером.  
_Задача: обновить состояние корзины на клиенте и отправить запрос на сервер._  

* getTotalPrice(): string - возвращает общую стоимость корзины в форматированном виде.  
_Задача: рассчитать и отобразить стоимость всех товаров._  

1.2. OrderModel  
Поля:  

* apiClient: ApiClient - объект для взаимодействия с API.  
* formatter: Formatter - объект для форматирования статусов и цен.  

Методы:  

* createOrder(user: UserAPI): Promise<OrderUI> - отправляет данные о заказе на сервер и возвращает объект заказа.  
_Задача: создание нового заказа._  

* fetchOrder(id: string): Promise<OrderUI> - получает данные заказа с сервера по идентификатору.  
_Задача: получить информацию о конкретном заказе._  

1.3. ProductModel  
Поля:  

* apiClient: ApiClient - объект для взаимодействия с API.  

Методы:  

* fetchProducts(): Promise<ProductUI[]> - получает список товаров с сервера.  
_Задача: загрузить данные каталога._  
* getProductById(id: string): Promise<ProductUI> - получает данные конкретного товара.  
_Задача: предоставить информацию для детального просмотра._  

2. **Слой представления:**  

2.1. BasketView  
Поля:  

* container: HTMLElement - DOM-элемент, где отображается корзина.  

Методы:  

* renderBasket(items: BasketItemUI[], total: string): void - отображает список товаров и общую стоимость.  
_Задача: отрисовать корзину на основе переданных данных._  

* showEmptyBasketMessage(): void - отображает сообщение о пустой корзине.  
_Задача: информировать пользователя о том, что корзина пуста._  

2.2. OrderView
Поля:

* formContainer: HTMLElement - DOM-элемент, где отображается форма заказа.  

Методы:  

* renderOrderForm(): void - отображает форму оформления заказа.  
_Задача: позволить пользователю ввести данные заказа._  

* renderSuccessMessage(order: OrderUI): void - отображает сообщение об успешном оформлении заказа.  
_Задача: проинформировать пользователя об успешном заказе._  

* showFormErrors(errors: string[]): void - отображает ошибки валидации формы.  
_Задача: помочь пользователю исправить ошибки._  

2.3. ProductView  
Поля:  

* galleryContainer: HTMLElement - DOM-элемент для списка товаров.  
* detailsContainer: HTMLElement - DOM-элемент для деталей товара.  

Методы:  

* renderProductList(products: ProductUI[]): void - отображает список товаров.
_Задача: отрисовать каталог товаров._
* renderProductDetails(product: ProductUI): void - отображает подробную информацию о товаре.
_Задача: показать информацию выбранного товара._  

3. **Слой презентера:**  

3.1 BasketController  
Поля:  

* basketModel: BasketModel - объект модели корзины.  
* basketView: BasketView - объект представления корзины.  

Методы:  

* showBasket(): Promise<void> - отображает корзину.  
_Задача: связать данные корзины с её представлением._  

* handleAddToBasket(productId: string): Promise<void> - обрабатывает добавление товара в корзину.  
_Задача: обновить данные корзины и её отображение._  

* handleRemoveFromBasket(productId: string): Promise<void> - обрабатывает удаление товара из корзины.  
_Задача: обновить данные корзины и её отображение._  

3.2 OrderController
Поля:  

* orderModel: OrderModel - объект модели заказа.  
* orderView: OrderView - объект представления заказа.  

Методы:  

* showOrderForm(): Promise<void> - отображает форму заказа.  
_Задача: связать представление формы с её логикой._  

* handleOrderSubmit(data: UserAPI): Promise<void> - обрабатывает отправку данных формы.  
_Задача: создать заказ и отобразить сообщение об успешном заказе._  

3.3 ProductController  
Поля:  

* productModel: ProductModel - объект модели товаров.  
* productView: ProductView - объект представления товаров.  

Методы:  

* showProductList(): Promise<void> - отображает каталог товаров.  
_Задача: связать данные товаров с их представлением._  

* showProductDetails(productId: string): Promise<void> - отображает детали выбранного товара.  
_Задача: показать информацию о выбранном товаре._  

### Пользовательские события.  
1. product:addToBasket  
Описание: Пользователь добавляет товар в корзину.
Обработчик: BasketController.handleAddToBasket(productId)  

2. basket:removeItem  
Описание: Пользователь удаляет товар из корзины.
Обработчик: BasketController.handleRemoveFromBasket(productId)  

3. basket:update
Описание: Обновление состояния корзины.
Обработчик: BasketView.renderBasket(items, total)  

4. order:submitted  
Описание: Пользователь отправляет заказ.
Обработчик: OrderController.handleOrderSubmit(data)  

5. order:success
Описание: Успешное создание заказа.
Обработчик: OrderView.renderSuccessMessage(order)  

Вышеперечисленные события связывают слои модели, представления и контроллера, обеспечивая динамическое поведение приложения.  

#### В рамках архитектуры приложения некоторые сущности имеют модель данных и представления, другим же достаточно только представления.  

### Сущности, имеющие модель данных и представление (View + Model):  

1. Класс EventEmitter  
Модель данных: управляет состоянием зарегистрированных событий и их обработчиков - регистрация слушателей событий (on), удаление слушателей (off), генерация событий (emit).   
Представление: фактически отсутствует, но опосредованно участвует через управление событиями  между различными частями приложения.  
```typescript
    interface EventEmitter {
    on(event: string, listener: (...args: any[]) => void): void;
    off(event: string, listener: (...args: any[]) => void): void;
    emit(event: string, ...args: any[]): void;
  }
```  

2. Класс Modal  
Модель данных: состояние модального окна (открыто/закрыто), текущий контент.  
Представление: отвечает за отображение модального окна и динамическое наполнение контента.  
```typescript
   interface Modal {
    open(content: HTMLElement): void;
    close(): void;
    setTitle(title: string): void;
  }
``` 

3. Класс Card  
Модель данных: данные о товаре (название, цена, категория, изображение).  
```typescript
   interface Card {
    renderCard(product: ProductUI): HTMLElement;
  }
``` 
Представление: создание и обновление отображения карточек для каталога, корзины и модальных окон.  

3. Класс Basket  
Модель данных: содержимое корзины (список товаров, их количество, общая стоимость).  
Представление: отображает содержимое корзины, кнопки удаления и оформление заказа.  
```typescript
 interface BasketModel {
    getBasket(): BasketItemUI[];
    addItemToBasket(productId: string): Promise<void>;
    removeItemFromBasket(productId: string): Promise<void>;
    getTotalPrice(): string;
  }
``` 

4. Класс OrderForm 
Модель данных: состояние формы (введённые данные, ошибки валидации, текущий этап).  
Представление: управляет отображением полей, ошибок и переходами между этапами оформления.  
```typescript
 interface OrderModel {
    createOrder(user: UserAPI): Promise<OrderUI>;
    fetchOrder(id: string): Promise<OrderUI>;
  }
```   

### Сущности, имеющие только с представления (View):  

1. Компонент Header  
Представление: отображает логотип и счётчик товаров в корзине.  
Связь с моделью: получает данные о количестве товаров из модели Basket.  

2. Компонент Gallery  
Представление: отображает карточки товаров.  
Связь с моделью: получает данные о товарах из класса Card.  

3. Компонент SuccessMessage  
Представление: отображает сообщение об успешном оформлении заказа.  
Связь с моделью: использует данные об итогах заказа из модели OrderForm.  

### Шаблоны (Templates)
Шаблоны предоставляют структуру для динамически генерируемого контента. 
Используются для создания карточек (card-catalog, card-basket), корзины (basket), форм заказа (order, contacts), а также сообщений о завершении (success). 
Шаблоны наполняются данными через соответствующие классы и вставляются в DOM.
Они динамически наполняются данными из соответствующих моделей (Card, Basket, OrderForm) через представление.



